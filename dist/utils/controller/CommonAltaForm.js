sap.ui.define(["simplot/portalsqas/utils/models","simplot/portalsqas/utils/gateway","simplot/portalsqas/utils/modelHelper","simplot/portalsqas/utils/Common"],function(e,a,o,t){"use strict";var r="NOTICIAS";var i="AUTOGESTION";var s="Model_Pizarron";var n="Model_ControllerMain";var l="Model_OC";var d="Model_MainAltaForm";return{getCommon:function(){var e=sap.ui.require("simplot/portalsqas/utils/Common");return e},getI18nText:function(a){return e.get("i18n").getProperty(a)},onLoadModelAlta:function(){var a=this.getCommon();if(e.exists(d)){}else{var t=o.getObjectJson();e.load(d,{rowsIVAIGA:[],rowsIIBB:[],MaestroProveedores:t,Paises:[],Provincias:[],HabilitaPcia:false,CatFiscal:[]})}a.onGetPaises();a.onGetImpuestos();this.onGetDataPartner();this.onGetDataPartnerAdj("Load")},onGetDataPartner:function(){var o=this;var t=e.get("Model_User").getProperty("/DataUser/BpPortal");var r="/ObtenerBasicoSet(IvBpPortal='"+t+"',IvTipoBp='P')";a.read(i,r,{}).then(function(t){console.log("Obtener Basico");console.log(t);var r=t;var s=e.get("Model_User").getProperty("/DataUser/GrupoBp");var n="/ObtenerBasConfSet(IvTipoBp='P',IvGrupoBp='"+s+"')";a.read(i,n,{}).then(function(t){var n=t;var l="/ObtenerBasModSet(IvTipoBp='P',IvGrupoBp='"+s+"')";a.read(i,l,{}).then(function(a){var t=a;var i=e.get("Model_User").getProperty("/DataUser");var s="";if(i.GrupoBp==="1"){s="AR"}if(r.Pais===""){r.Pais=s}debugger;if(r.EvTipo==="E"){sap.m.MessageBox.error(r.EvMensaje)}else{o.onLoadDataAltaForm(r,n,t)}}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})})},onLoadCountDocumentacion:function(a,o){var t=this.getCommon();var r=[];for(var i in a){r.push(a[i]);for(var s in o){if(a[i].CodAdj===o[s].CodAdj){r[i].Carga="S";r[i].FechaCarga=o[s].Vencimiento}}}var l=r.filter(e=>e.TipoAdj==="M");var d=l.filter(e=>e.Carga!="S");var c=[];for(var f in l){var v=new Date(t.formatDate(t.formatDate(l[f].FechaCarga,"Main"),"FormatAAAAmmDD"));if(new Date>=new Date(v)){c.push(l[f])}}e.get(n).setProperty("/Documentacion/CountVencidas",c.length);e.get(n).setProperty("/Documentacion/CountPendientes",d.length);e.get(n).refresh()},onGetDataPartnerAdj:function(o){var t=this;var r=e.get("Model_User").getProperty("/DataUser");var s="/ListaAdjConfSet";var n=new sap.ui.model.Filter("IvGrupoBp","EQ",r.GrupoBp);var l=new sap.ui.model.Filter("IvTipoBp","EQ",r.TipoBp);a.read(i,s,{filters:[l,n]}).then(function(e){var s=e.results;var n=new sap.ui.model.Filter("IvBpPortal","EQ",r.BpPortal);var l=new sap.ui.model.Filter("IvTipoBp","EQ",r.TipoBp);var d="/ListaAdjSet";a.read(i,d,{filters:[n,l]}).then(function(e){var a=e.results;if(o==="Load"){t.onLoadDataArchivo(s,a)}t.onLoadCountDocumentacion(s,a)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},isModify:function(e){var a=true;if(e==="X"){a=true}else{a=false}return a},isRequerido:function(a,o,t,r){var i={Requerido:true,Habilitado:true,IsModify:true};if(a===""){i.Requerido=false;i.Habilitado=false}else if(a==="1"){i.Requerido=true;i.Habilitado=true}else if(a==="2"){i.Requerido=false;i.Habilitado=true}if(o==="1"||o==="2"||o==="3"){i.Habilitado=false}if(t==="X"){i.IsModify=true}else{i.IsModify=false}if(r==="X"){e.get(d).setProperty("/HabilitaPcia",i.Habilitado);e.get(d).refresh()}return i},getState:function(e){var a=this.getCommon();var o={Descripcion:"",State:""};if(e==="0"){o.State="Warning";o.Descripcion=a.getI18nText("Pendiente")}else if(e==="1"){o.State="Warning";o.Descripcion=a.getI18nText("Enviado")}else if(e==="2"){o.State="Success";o.Descripcion=a.getI18nText("EnProceso")}else if(e==="3"){o.State="Success";o.Descripcion=a.getI18nText("Completo")}return o},isValid:function(e,a){var o={boolHabilitado:true,boolBtnModifica:true,boolBtnSave:true,boolBtnSend:true,boolBtnCancel:false};var t=true;if(e==="0"&&a==="A"){o.boolHabilitado=true;o.boolBtnSave=true;o.boolBtnSend=true;o.boolBtnModifica=false;o.boolBtnCancel=false}else if(e==="0"&&a==="M"){o.boolHabilitado=false;o.boolBtnSave=false;o.boolBtnSend=true;o.boolBtnModifica=false;o.boolBtnCancel=false}else if(e==="1"){o.boolHabilitado=false;o.boolBtnSave=false;o.boolBtnSend=false;o.boolBtnModifica=false;o.boolBtnCancel=false}else if(e==="2"){o.boolHabilitado=false;o.boolBtnSave=false;o.boolBtnSend=false;o.boolBtnModifica=false;o.boolBtnCancel=false}else if(e==="3"){o.boolHabilitado=false;o.boolBtnSave=false;o.boolBtnSend=false;o.boolBtnModifica=true;o.boolBtnCancel=false}return o},onEnableFields:function(a){var o=e.get(d).getProperty("/MaestroProveedores/DatosBasicos");var t=e.get(d).getProperty("/MaestroProveedores/Direccion");var r=e.get(d).getProperty("/MaestroProveedores/DatosBanco");var i=e.get(d).getProperty("/MaestroProveedores/Impuesto");for(var s in o){var n="/MaestroProveedores/DatosBasicos/"+s+"/Validar/Habilitado";var l=a;if(a){l=o[s].Validar.IsModify}else{l=false}e.get(d).setProperty(n,l)}for(var c in t){var n="/MaestroProveedores/Direccion/"+c+"/Validar/Habilitado";var f=a;if(a){f=t[c].Validar.IsModify}else{f=false}e.get(d).setProperty(n,f)}for(var v in r){var n="/MaestroProveedores/DatosBanco/"+v+"/Validar/Habilitado";var u=a;if(a){u=r[v].Validar.IsModify}else{u=false}e.get(d).setProperty(n,u)}for(var p in i){var n="/MaestroProveedores/Impuesto/"+p+"/Validar/Habilitado";var u=a;if(a){u=i[p].Validar.IsModify}else{u=false}e.get(d).setProperty(n,u)}e.get(d).setProperty("/HabilitaPcia",a);e.get(d).setProperty("/MaestroProveedores/Habilitado/boolBtnCancel",a);e.get(d).refresh();e.get(d).refresh()},onLoadDataAltaForm:function(a,o,t){var r=this;var i=this.getCommon();var s={Nombre:{Texto:a.Nombre,Validar:r.isRequerido(o.Nombre,a.Estado,t.Nombre,"")},Telefono:{Texto:a.Telefono,Validar:r.isRequerido(o.Telefono,a.Estado,t.Telefono,"")},Mail:{Texto:a.Mail,Validar:r.isRequerido(o.Mail,a.Estado,t.Mail,"")},CUIT:{Texto:a.Nif,Validar:r.isRequerido(o.Nif,a.Estado,t.Nif,"")},InicioAct:{Texto:i.formatDate(a.Fechainiact,"Main"),Validar:r.isRequerido(o.Fechainiact,a.Estado,t.Fechainiact,"")}};var n={Calle:{Texto:a.Calle,Validar:r.isRequerido(o.Calle,a.Estado,t.Calle,"")},Ciudad:{Texto:a.Ciudad,Validar:r.isRequerido(o.Ciudad,a.Estado,t.Ciudad,"")},CP:{Texto:a.Cp,Validar:r.isRequerido(o.Cp,a.Estado,t.Cp,"")},Pais:{Texto:a.Pais,Validar:r.isRequerido(o.Pais,a.Estado,t.Pais,"")},Idioma:{Texto:a.Idioma,Validar:r.isRequerido(o.Idioma,a.Estado,t.Idioma,"")},Provincia:{Texto:a.Provincia,Validar:r.isRequerido(o.Provincia,a.Estado,t.Provincia,"X")},Nrocalle:{Texto:a.Nrocalle,Validar:r.isRequerido(o.Nrocalle,a.Estado,t.Nrocalle,"")}};var l={Banco:{Texto:a.Banco,Validar:r.isRequerido(o.Banco,a.Estado,t.Banco,"")},CBU:{Texto:a.Cbu,Validar:r.isRequerido(o.Cbu,a.Estado,t.Cbu,"")},CtaBancaria:{Texto:a.Ctabancaria,Validar:r.isRequerido(o.Ctabancaria,a.Estado,t.Ctabancaria,"")}};var c={Iga:{Texto:a.Iga,Validar:r.isRequerido(o.Iga,a.Estado,t.Iga,"")},Iva:{Texto:a.Iva,Validar:r.isRequerido(o.Iva,a.Estado,t.Iva,"")},Iibb:{Texto:a.Iibb,Validar:r.isRequerido(o.Iibb,a.Estado,t.Iibb,"")}};var f={Id:a.Estado,Descripcion:this.getState(a.Estado).Descripcion,State:this.getState(a.Estado).State};var v={Id:a.Operacion,Descripcion:a.Operacion};var u=this.isValid(a.Estado,a.Operacion);if(n.Pais.Texto===""){}else{i.onGetPcia(n.Pais.Texto,"X")}e.get(d).setProperty("/MaestroProveedores/Habilitado",u);e.get(d).setProperty("/MaestroProveedores/DatosBasicos",s);e.get(d).setProperty("/MaestroProveedores/Direccion",n);e.get(d).setProperty("/MaestroProveedores/Impuesto",c);e.get(d).setProperty("/MaestroProveedores/DatosBanco",l);e.get(d).setProperty("/MaestroProveedores/Estado",f);e.get(d).setProperty("/MaestroProveedores/Operacion",v);e.get(d).refresh()},onReturnDataAdjBP:function(e,a){var o=this.getCommon();var t=a.filter(a=>a.CodAdj===e);if(t.length>0){t[0].FechaVence=o.formatDate(t[0].Vencimiento,"Main");return t[0]}else{return null}},onLoadDataArchivo:function(a,o){var t=[];for(var r in a){var i=true;var s=this.onReturnDataAdjBP(a[r].CodAdj,o);var n="";var l=true;if(a[r].TipoAdj==="M"){i=true}else{i=false}if(s!==null){n=s.FechaVence;l=true}else{n="";l=false}var c={Tipo:a[r].DescAdj,FechaVence:n,Codigo:a[r].CodAdj,Obliga:i,IsLoad:l};t.push(c)}e.get(d).setProperty("/MaestroProveedores/Archivos",t);e.get(d).setProperty("/MaestroProveedores/maxArchivos",t.length);e.get(d).refresh()}}});