sap.ui.define(["simplot/portalsqas/utils/models","simplot/portalsqas/utils/gateway"],function(e,t){"use strict";return{reasons:{},claims:{},getCommon:function(){var e=sap.ui.require("simplot/portalsqas/utils/Common");return e},getServiceName:function(){return"claims"},getModelName:function(){return"Model_Claims"},getPriorities:function(){return[{id:"1",descripcion:this.getI18nText("claim.priority.low")},{id:"2",descripcion:this.getI18nText("claim.priority.normal")},{id:"3",descripcion:this.getI18nText("claim.priority.high")}]},getStatuses:function(){return[{id:"1",descripcion:this.getI18nText("claim.status.new")},{id:"2",descripcion:this.getI18nText("claim.status.inProcess")},{id:"3",descripcion:this.getI18nText("claim.status.closed")}]},setModelReasons:function(e){this.getModelClaims().setProperty("/Reasons/Data",e);this.getModelClaims().setProperty("/Reasons/Count",Object.keys(e).length);this.getModelClaims().refresh();console.log(e)},getReasons:function(e=false){let t=null;if(e){this.claims={}}if(!Object.keys(this.reasons).length){t=this.loadReasons().then(e=>{this.setModelReasons(e);return e})}else{t=Promise.resolve(this.reasons)}return t},loadReasons:function(){return t.read(this.getServiceName(),"/MotivosSet").then(e=>{this.reasons=e.results.reduce((e,t)=>{e[t.Motivo]=t;return e},{});console.log(e);return this.reasons}).catch(function(e){console.log(e)})},getI18nText:function(t){return e.get("i18n").getProperty(t)},navToClaims:function(e){return this.getReasons().finally(()=>{e.display("claims")})},navToClaim:function(e,t){return this.loadClaim(t).then(()=>{e.display("claim",{nrorec:t})})},setModelClaims:function(t){this.getModelClaims().setProperty("/Claims/Data",Object.values(t));this.getModelClaims().setProperty("/Claims/Count",Object.keys(t).length);this.getModelClaims().setProperty("/Claims/CountNew",Object.values(t).filter(e=>e.Estado==="1").length);this.getModelClaims().setProperty("/Claims/CountInProcess",Object.values(t).filter(e=>e.Estado==="2").length);this.getModelClaims().refresh();e.get("Model_ControllerMain").setProperty("/Reclamos/CountNew",Object.values(t).filter(e=>e.Estado==="1").length);e.get("Model_ControllerMain").setProperty("/Reclamos/CountInProcess",Object.values(t).filter(e=>e.Estado==="2").length);e.get("Model_ControllerMain").refresh();console.log(t)},getClaimAttachment:function(s,i){if(!s||!i){return Promise.reject()}const o="/"+e.get(this.getServiceName()).createKey("AdjuntoSet",{Nrorec:s,Archivo:i});return t.read(this.getServiceName(),o).then(e=>e).catch(function(e){console.log(e)})},getClaims:function(e,t=false){let s=null;if(t){this.claims={}}if(!Object.keys(this.claims).length){s=this.loadClaims()}else{s=Promise.resolve(this.claims)}return s.then(e=>{this.setModelClaims(e);return e})},loadClaims:function(e){e=e||[];return t.read(this.getServiceName(),"/ReclamoSet",{filters:this.getDefaultFilters().concat(e)}).then(e=>{this.claims=e.results.reduce((e,t)=>{e[t.Nrorec]=t;return e},{});return this.claims}).catch(function(e){console.log(e)})},loadClaim:function(e){return t.read(this.getServiceName(),`/ReclamoSet('${e}')`,{urlParameters:{$expand:"Posiciones,Adjuntos"}}).then(e=>e).catch(function(e){console.log(e)})},getModelClaims:function(){if(!e.exists(this.getModelName())){this.initModelClaims()}return e.get(this.getModelName())},initModelClaims:function(){e.load(this.getModelName(),{Claims:{Data:{},Count:0,CountNew:0,CountInProcess:0},Reasons:{Data:{},Count:0}})},getBpSap:function(){var t=e.get("Model_User").getProperty("/DataUser");return this.zeroPad(t.BpSap,10)},getDefaultFilters:function(){return[new sap.ui.model.Filter("BpSap","EQ",this.getBpSap())]},zeroPad:function(e,t){const s=t-e.toString().length+1;return Array(+(s>0&&s)).join("0")+e}}});