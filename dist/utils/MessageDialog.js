sap.ui.define(["sap/ui/base/EventProvider","./ResourceBundle","./MessageParser"],function(e,s,t){"use strict";var r=null,o=e.extend("simplot.portalsprd.utils.MessageDialog",{constructor:function(){e.apply(this);this.init()}});o.prototype.init=function(){var e=this;this._oMessageParser=new t;this._oMessageProcessor=new sap.ui.core.message.ControlMessageProcessor;var s=sap.ui.getCore().getMessageManager();s.registerMessageProcessor(this._oMessageProcessor);var r=new sap.m.MessageItem({description:"{description}",type:"{type}",subtitle:"{description}",title:"{message}"});var o=new sap.m.Button({icon:sap.ui.core.IconPool.getIconURI("nav-back"),visible:false,press:function(){e._oMessageView.navigateBack();this.setVisible(false)}});this._oMessageView=new sap.m.MessageView({showDetailsPageHeader:false,itemSelect:function(){o.setVisible(true)},items:{path:"/",template:r}});this._oMessageView.setModel(s.getMessageModel());this._oDialog=new sap.m.Dialog({customHeader:new sap.m.Bar({contentRight:[new sap.m.Button({icon:"sap-icon://decline",press:function(e){e.getSource().getParent().getParent().close()}})],contentMiddle:[new sap.m.Title({text:"Mensajes"})],contentLeft:[o]}),resizable:true,content:this._oMessageView,state:"Error",contentHeight:"300px",contentWidth:"500px",verticalScrolling:false}).attachAfterClose({},function(){sap.ui.getCore().getMessageManager().removeAllMessages();e.fireEvent("closed")},this).attachBeforeClose({},function(){e._oMessageView.navigateBack()},this);this._oDialog.setModel(s.getMessageModel())};o.prototype.hasErrorMessage=function(e){return e&&e.__batchResponses&&e.__batchResponses.some(function(e){return e.response&&e.response.statusCode&&!e.response.statusCode.startsWith("2")})};o.prototype.showMessage=function(){if(this._oDialog.isOpen()){return}this._oDialog.open()};o.prototype.addBatchResponseError=function(e){sap.ui.getCore().getMessageManager().removeAllMessages();let s=e.__batchResponses.filter(function(e){return e.response&&!e.response.statusCode.startsWith("2")}).map(function(e){return this._oMessageParser.parse(e.response.body)}.bind(this)).reduce(function(e,s){if(s.error.innererror&&s.error.innererror.errordetails.length>0){e=e.concat(s.error.innererror.errordetails)}else{e=e.concat(s.error)}return e},[]);s.forEach(function(e){this.addMessage(e,sap.ui.core.MessageType.Error)}.bind(this));this.showMessage()};o.prototype.addResponse=function(e){if(e){sap.ui.getCore().getMessageManager().removeAllMessages();const s=this._oMessageParser.parse(e);if(s&&s.length){s.forEach(function(e){this.addMessage(e,sap.ui.core.MessageType.Error)}.bind(this));this.showMessage()}}};o.prototype.addFunctionError=function(e){sap.ui.getCore().getMessageManager().removeAllMessages();const s=this._oMessageParser.parse(e.responseText);this.addMessage(s.error,sap.ui.core.MessageType.Error);this.showMessage()};o.prototype.showSingleError=function(e){sap.ui.getCore().getMessageManager().removeAllMessages();const s=this._oMessageParser.parse(e.responseText);sap.m.MessageBox.error(s.error.message)};o.prototype.addMessage=function(e,s){sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({code:e.code,message:e.code,description:e.message,type:s,processor:this._oMessageProcessor}))};o.prototype.parseMessage=function(e){let s={};if(e.startsWith("<")){s=this.parseXml(e)}else{s=JSON.parse(e);s={error:{...s.error,message:s.error.message.value}}}return s};o.prototype.parseXml=function(e){let s=new DOMParser,t=s.parseFromString(e,"text/xml");return{error:{code:t.getElementsByTagName("code")[0].childNodes[0].nodeValue,message:t.getElementsByTagName("message")[0].childNodes[0].nodeValue}}};return{getInstance:function(){if(!r){r=new o}return r}}});