sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","simplot/portalsprd/controller/BaseController","simplot/portalsprd/model/Claim/formatter","simplot/portalsprd/utils/controller/CommonClaims"],function(t,e,i,o,s,r){"use strict";return o.extend("simplot.portalsprd.controller.Claim.Claims",{CommonClaims:r,formatter:s,onInit:function(){this._oTable=this.getView().byId("claims-table");this.setModel(new i({Statuses:r.getStatuses()}),"matchcodes");this.setModel(r.getModelClaims());this.getRouter().getTarget("claims").attachDisplay(this._onClaimsMatched,this)},onSearch:function(t){this._oTable.getBinding("rows").filter(this._buildFilters(),sap.ui.model.FilterType.Application)},onNavBack:function(t){this.getOwnerComponent().getTargets().display("TargetMain")},onCreateClaimsPress:function(){this.saveSortingState();r.navToClaim(this.getOwnerComponent().getTargets())},onViewClaimPress:function(t){this.saveSortingState();const e=t.getSource();r.navToClaim(this.getOwnerComponent().getTargets(),e.getBindingContext().getProperty("Nrorec"))},_onClaimsMatched:function(){this._oTable.setBusy(true);this._initModels();this._loadClaimsData().then(()=>{this._oTable.getBinding("rows").filter(this._buildFilters(),sap.ui.model.FilterType.Application);this.restoreSortingState();this.getModel("viewModel").setProperty("/tableTitle",this.getResourceBundle().getText("claim.title.count",[this.getModel().getProperty("/Claims/Count")]))}).finally(()=>{this._oTable.setBusy(false)})},_setSortedColumn:function(t,e){this._resetSortingState();t.setSorted(true);t.setSortOrder(e)},_buildFilters:function(){const t=$.extend(true,{},this.getModel("filterModel").getObject("/filter"));return this._prepareFilters(t)},_prepareFilters:function(i){return Object.keys(i).filter(t=>i[t]!==null&&i[t]!==undefined&&(!Array.isArray(i[t])||i[t].length)).map(o=>{let s=null;if(Array.isArray(i[o])){s=new t(i[o].map(i=>new t(o,e.EQ,i)),false)}else{s=new t(o,e.Contains,i[o])}return s})},_initModels:function(){this._oViewModel=new i({tableTitle:this.getResourceBundle().getText("claim.title"),tableNoDataText:this.getResourceBundle().getText("claim.tableNoDataText")});this.setModel(this._oViewModel,"viewModel");this.setModel(new i({filter:{Titulo:null,Estado:["1","2"]}}),"filterModel")},_loadClaimsData:function(t=[]){return r.getClaims(t,true)},_resetSortingState:function(){var t=this._oTable.getColumns();for(var e=0;e<t.length;e++){t[e].setSorted(false)}},restoreSortingState:function(){let t="Nrorec",e=sap.ui.table.SortOrder.Descending;if(this.sortingStateColumn){t=this.sortingStateColumn.getSortProperty();e=this.sortingStateColumn.getSortOrder();this._setSortedColumn(this.sortingStateColumn,e)}else{this._setSortedColumn(this.byId("nrorecColumn"),sap.ui.table.SortOrder.Descending)}this._oTable.getBinding("rows").sort(new sap.ui.model.Sorter("Nrorec",e===sap.ui.table.SortOrder.Descending))},saveSortingState:function(){const t=this._oTable.getColumns(),e=t.find(t=>t.getSorted());this.sortingStateColumn=null;if(e){this.sortingStateColumn=e}}})});