sap.ui.define(["simplot/portalsprd/controller/BaseController","simplot/portalsprd/utils/models","simplot/portalsprd/utils/gateway","simplot/portalsprd/utils/Common"],function(e,t,o,s){"use strict";var a="Model_ControllerMain";return e.extend("simplot.portalsprd.controller.Main",{onInit:function(){console.log("V20230929");t.load(a,{UserEnabled:false,Targets:this.getOwnerComponent().getTargets(),ControllerMain:this,Apps:[{App:"Pizarron",canUseApp:false},{App:"OC",canUseApp:false},{App:"Reclamos",canUseApp:false},{App:"CuentaCorriente",canUseApp:false},{App:"Facturas",canUseApp:false},{App:"FacturasView",canUseApp:false}],OC:{CountCumplida:0,CountRecepParcial:0,DescCumplida:"",DescRecepParcial:"",canUseApp:false,rowsOC:[]},Pizarron:{CountNoticias:0,canUseApp:false},Reclamos:{CountNew:0,CountInProcess:0,canUseApp:false},Documentacion:{CountVencidas:0,CountPendientes:0}});var e=sap.ushell.Container.getUser();console.log(e.getEmail());s.onLoadModelUser(e.getEmail());this.getView().setModel(t.get(a))},getToken:function(){return new Promise(function(e,t){$.ajax({type:"GET",url:$.appModulePath,headers:{"X-CSRF-Token":"Fetch"},success:function(t,o,s){e(s.getResponseHeader("X-CSRF-Token"))},error:function(t){e(t.getResponseHeader("X-CSRF-Token"))},contentType:"application/json"})})},fetchTokenNew:function(){this.getToken().then(function(e){var t={url:$.appModulePath+"/sap/opu/odata/sap/ZBP_AFIP_SRV/ListaCatFiscalSet",method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":e}};$.ajax(t).done(function(e){console.log("ressuccess");console.log(e)}).fail(function(e){console.log("resfailed");console.log(e)})})},onPressOCCumplida:function(){this.onPressOC("1")},onPressOCRecepParcial:function(){this.onPressOC("3")},onPressOC:function(e){var o=t.get(a).getProperty("/Apps").filter(e=>e.App==="OC")[0];if(o.canUseApp){var r=t.get(a).getProperty("/Targets");if(e==="1"||e==="3"){s.navToOC(r,e)}else{s.navToOC(r,null)}}else{sap.m.MessageBox.error(s.getI18nText("NotNroSap"))}},onPressAltaForm:function(){var e=t.get(a).getProperty("/Targets");s.navToAltaForm(e)},onPressReclamos:function(e){const o=e.getSource();o.setBusy(true);var r=t.get(a).getProperty("/Targets");s.navToClaims(r).finally(()=>{o.setBusy(false)})},onPressPizarron:function(){var e=t.get(a).getProperty("/Apps").filter(e=>e.App==="Pizarron")[0];if(e.canUseApp){var o=t.get(a).getProperty("/Targets");s.navToPizarron(o)}else{sap.m.MessageBox.error(s.getI18nText("NotBpSap"))}},onPressFacturas:function(){var e=t.get(a).getProperty("/Apps").filter(e=>e.App==="Facturas")[0];if(e.canUseApp){var o=t.get(a).getProperty("/Targets");s.navToFacturas(o)}else{sap.m.MessageBox.error(s.getI18nText("NotBpSap"))}},onPressViewFacturas:function(){var e=t.get(a).getProperty("/Apps").filter(e=>e.App==="FacturasView")[0];if(e.canUseApp){var o=t.get(a).getProperty("/Targets");s.navToViewFacturas(o)}else{sap.m.MessageBox.error(s.getI18nText("NotBpSap"))}},onPressCtaCte:function(){var e=t.get(a).getProperty("/Apps").filter(e=>e.App==="CuentaCorriente")[0];if(e.canUseApp){var o=t.get(a).getProperty("/Targets");s.navToCtaCte(o)}else{sap.m.MessageBox.error(s.getI18nText("NotBpSap"))}}})});