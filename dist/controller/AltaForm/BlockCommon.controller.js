sap.ui.define(["simplot/portalsprd/utils/FileReaderHelp","simplot/portalsprd/utils/models","simplot/portalsprd/utils/gateway"],function(e,o,r){"use strict";var t="Model_MainAltaForm";var a="AUTOGESTION";var l=sap.ui.require("simplot/portalsprd/utils/models");var i=sap.ui.require("simplot/portalsprd/utils/gateway");var s=sap.ui.require("simplot/portalsprd/utils/FileDownHelp");var n=sap.ui.require("simplot/portalsprd/utils/Common");var d=sap.ui.require("simplot/portalsprd/utils/controller/CommonAltaForm");jQuery.sap.declare({modName:"simplot.portalsprd.controller.AltaForm.BlockCommon",type:"controller"});sap.ui.core.mvc.Controller.extend("simplot.portalsprd.controller.AltaForm.BlockCommon",{handlePress:function(){var e=this.oParentBlock.getMode()==sap.uxap.ObjectPageSubSectionMode.Collapsed?sap.uxap.ObjectPageSubSectionMode.Expanded:sap.uxap.ObjectPageSubSectionMode.Collapsed;this.oParentBlock.setMode(e)},onPressDownFile:function(e){var o=l.get("Model_User").getProperty("/DataUser/BpPortal");var r=e.getSource().getBindingContext().sPath;var t=e.getSource().getModel().getProperty(r);var a=t.Codigo;var i="/ObtenerAdjSet(IvBpPortal='"+o+"',IvCodAdj='"+a+"',IvTipoBp='P')";n.onDownloadArchivo(i)},onPressUpFile:function(e){var o=e.getSource().getBindingContext().sPath;var r=e.getSource().getModel().getProperty(o);var t=l.get("Model_User").getProperty("/DataUser/BpPortal");l.load("Model_SendFile",{File:{},Vence:"",SelectData:r});var s,p=new jQuery.Deferred;var c=this;if(!this._ControllerSendFile){this._ControllerSendFile={deferred:null,onSendFile:function(e){var o=e.getSource().getModel().getProperty("/File");var r=e.getSource().getModel().getProperty("/Vence");if(r===""){sap.m.MessageBox.error(n.getI18nText("FechaValid"))}else if(o.IvContenido===undefined){sap.m.MessageBox.error(n.getI18nText("ArchivoValid"))}else{r=n.formatDate(r,"Update");o.IvVencimiento=r;var t="/GuardarAdjSet";i.create(a,t,o).then(function(e,o){console.log(e);if(e.EvTipo==="E"){sap.m.MessageBox.error(e.EvMensaje)}else{sap.ui.getCore().byId("myFileUpload").clear();d.onGetDataPartnerAdj("Load");sap.m.MessageBox.success(e.EvMensaje)}}).catch(function(e){sap.m.MessageBox.error(n.getI18nText("ErrorAdjunto"));sap.ui.getCore().byId("myFileUpload").clear();console.log(e)});s.close()}},onFileUpload:function(e){var o=sap.ui.require("simplot/portalsprd/utils/FileReaderHelp");var r=e.getParameter("files")[0];if(r){var t=r;o.readBinaryString(t,jQuery.proxy(this.onFileLoadedRecursive,this,r))}},onFileLoadedRecursive:function(e,o){var r=e.name;var a=l.get("Model_SendFile").getProperty("/SelectData").Codigo;var i={IvBpPortal:t,IvCodAdj:a,IvContenido:o,IvNombreArch:r,IvTipoBp:"P",IvVencimiento:"20220101"};l.get("Model_SendFile").setProperty("/File",i)},onPressCancel:function(){sap.ui.getCore().byId("myFileUpload").clear();s.close()}}}this._ControllerSendFile.deferred=p;if(!this._DialogSendFile){this._DialogSendFile=sap.ui.xmlfragment("simplot.portalsprd.view.fragment.SendFile",this._ControllerSendFile);if(this.getView())this.getView().addAssociation(this._DialogSendFile)}s=this._DialogSendFile;s.setModel(l.get("Model_SendFile"));this.getView().addDependent(s);s.open()},onUploadComplete:function(e){var o=this.getView().byId("fileUploader");o.clear()},handleUploadComplete:function(e){console.log("lala")},onChangePais:function(e){console.log("lalachangecommonblock");var o=e.getSource().getModel().getProperty("/MaestroProveedores/Direccion/Pais/Texto");n.onGetPcia(o,"")}})}());