sap.ui.define(["simplot/portalsprd/controller/BaseController","simplot/portalsprd/utils/models","simplot/portalsprd/utils/gateway","simplot/portalsprd/utils/Common","sap/ui/core/BusyIndicator"],function(e,t,o,r,n){"use strict";var s="ORDEN_COMPRA";var a="Model_OC";return e.extend("simplot.portalsprd.controller.OC.OrdenCompra",{onInit:function(){console.log("onInit V20220131");this._onObjectMatched()},formatter:r,_onObjectMatched:function(){this.getView().setModel(t.get(a))},onAfterRendering:function(){console.log("onAfter")},onLoadModelOC:function(){t.load(a,{rowsOrdenCompra:[],rowsOrdenCompraBack:[],tileFecha:(new Date).toLocaleDateString(),rowsHeaderOC:[],rowsItemsOC:[],rowsItemsOCMax:0,visibleDetail:false,isShowMode:true,iconExpand:"sap-icon://full-screen"});this.getView().setModel(t.get(a))},onHideMaster:function(e){var o=t.get(a);if(o.getProperty("/isShowMode")){this.byId("idAppControl").setMode("HideMode");o.setProperty("/isShowMode",false);o.setProperty("/iconExpand","sap-icon://exit-full-screen")}else{this.byId("idAppControl").setMode("ShowHideMode");o.setProperty("/isShowMode",true);o.setProperty("/iconExpand","sap-icon://full-screen")}o.refresh()},onHideOnSelect:function(){var e=t.get(a);this.byId("idAppControl").setMode("ShowHideMode");e.setProperty("/isShowMode",false);e.setProperty("/iconExpand","sap-icon://exit-full-screen");e.refresh();this.byId("idAppControl").setMode("HideMode")},onGetListOC:function(){var e="/OCListadoSet";var n=t.get("Model_User").getProperty("/DataUser/NrSap");var i=new sap.ui.model.Filter("IvLifnr","EQ",n);o.read(s,e,{filters:[i]}).then(function(e){var o=e.results;for(var n in o){o[n].Fecha=r.formatDate(o[n].Aedat,"Main");if(o[n].IdEstado==="1"){o[n].InfoStatus="Success"}else if(o[n].IdEstado==="2"){o[n].InfoStatus="Information"}else if(o[n].IdEstado==="3"){o[n].InfoStatus="Warning"}else if(o[n].IdEstado==="4"){o[n].InfoStatus="Error"}}t.get(a).setProperty("/rowsOrdenCompra",o);t.get(a).setProperty("/rowsOrdenCompraBack",o);t.get(a).refresh();console.log(e)}).catch(function(e){console.log(e)})},onSelectionOCChange:function(e){var t=e.getParameter("listItem").getBindingContext().getProperty("Ebeln");this.onLoadModelHeadItem(t);this.onHideOnSelect();console.log("select")},onLoadModelHeadItem:function(e){var n="/OCCabeceraSet";var i=new sap.ui.model.Filter("IvEbeln","EQ",e);o.read(s,n,{filters:[i]}).then(function(n){var i=n.results;for(var l in i){i[l].Fecha=r.formatDate(i[l].Aedat,"Main")}t.get(a).setProperty("/rowsHeaderOC",i);t.get(a).setProperty("/visibleDetail",true);t.get(a).refresh();console.log(n);var d="/OCItemSet";var c=new sap.ui.model.Filter("IvEbeln","EQ",e);o.read(s,d,{filters:[c]}).then(function(e){var o=e.results;for(var n in o){o[n].FechaEM=r.formatDate(o[n].Lewed,"Main")}t.get(a).setProperty("/rowsItemsOC",o);t.get(a).setProperty("/rowsItemsOCMax",o.length);t.get(a).refresh();console.log(e)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},onSearch:function(e){var o={ListBack:"/rowsOrdenCompraBack",Value:e.getSource().getValue(),Model:t.get(a),List:"/rowsOrdenCompra",StringSearch:"Ebeln",NumberSearch:"Ebeln"};r.onSearch(o)},onNavBack:function(e){this.getOwnerComponent().getTargets().display("TargetMain")},onPressFilterCumpl:function(){this.onPressFilter("1","")},onPressFilterFcPend:function(){this.onPressFilter("3","")},onPressFilterParcial:function(){this.onPressFilter("2","")},onPressFilterRecePend:function(){this.onPressFilter("4","")},onCancelFilter:function(){this.onPressFilter("","")},onPressFilter:function(e,o){var r;var n=t.get(a).getProperty("/rowsOrdenCompraBack");if(e===""){r=n}else{if(o===""){r=n.filter(t=>t.IdEstado===e)}else{r=n.filter(t=>t.IdEstado===e||t.IdEstado===o)}}t.get(a).setProperty("/rowsOrdenCompra",r);t.get(a).refresh()},onPressPDFOC:function(e){var t=e.getSource().getModel().getData().rowsHeaderOC;if(t.length>0){n.show();var a=t[0].Ebeln;var i="OC_"+a+".pdf";var l="/OCPdfSet('"+a+"')";o.read(s,l,{}).then(function(e){if(e.EvTipo==="S"){r.onDownloadFile(e.EvPdf,"",i)}else{sap.m.MessageBox.error(e.EvMensaje)}n.hide()}).catch(function(e){console.log("errr");n.hide()})}}})});